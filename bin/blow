#!/usr/bin/env node

var path = require('path');

var core = require( path.resolve(path.dirname(module.filename), '../blow.js') );

var argv = process.argv.slice(2);
var files = [];
var args = [];

argv.forEach(function (arg) {
  if (arg[0] === '-') {
    args.push(arg);
  } else {
    files.push(path.resolve(arg));
  }
});

// var parse settings
var match = /^-(-)?([a-z]+)=(.+)$/;
var settings = {
  port: 0,
  address: '0.0.0.0',
  style: 'bdd',
  index: path.resolve(path.dirname(module.filename), '../index.html')
};
var map = {
  'p': 'port',
  'a': 'address',
  's': 'style',
  'i': 'index'
};
args.forEach(function (string) {
  var result = string.match(match);

  if (result[1] === undefined) {
    result[2] = map[result[2]];
  }

  if (result[3] === 'port') {
    result[2] = parseInt(result[2], 10);
  } else if (result[3] === 'index') {
    result[2] = path.resolve(result[2]);
  }

  if (settings.hasOwnProperty(result[2])) {
    settings[result[2]] = result[3];
  }
});

// start server
core(files, settings);
